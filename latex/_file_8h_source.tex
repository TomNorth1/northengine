\hypertarget{_file_8h_source}{}\doxysection{File.\+h}
\label{_file_8h_source}\index{src/rend/sys/File.h@{src/rend/sys/File.h}}
\mbox{\hyperlink{_file_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef SYS\_FILE\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define SYS\_FILE\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_zero_8h}{Zero.h}}"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_string_8h}{String.h}}"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_exception_8h}{Exception.h}}"{}}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{panic_8h}{panic.h}}"{}}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_vector_8h}{Vector.h}}"{}}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacesys}{sys}}}
\DoxyCodeLine{13 \{}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_file}{File}}}
\DoxyCodeLine{16 \{}
\DoxyCodeLine{17   \mbox{\hyperlink{structsys_1_1_file_a83b24191d03390eb9b90d716ce6703be}{File}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_string}{String}}\& \_path) : \mbox{\hyperlink{structsys_1_1_file_abc162e8cf65527d4cc1f606c5560ee35}{m\_path}}(\_path) \{ \}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19   \mbox{\hyperlink{structsys_1_1_file_a8bdba24620f100fa9dc27f9dd5bdce14}{\string~File}}()}
\DoxyCodeLine{20   \{}
\DoxyCodeLine{21     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}})}
\DoxyCodeLine{22     \{}
\DoxyCodeLine{23       fclose(\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}});}
\DoxyCodeLine{24     \}}
\DoxyCodeLine{25   \}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27   \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{structsys_1_1_file_ae950b3c54f48cc9fb1162719427295cd}{read}}(\mbox{\hyperlink{structsys_1_1_vector}{Vector<unsigned char>}}\& \_output)}
\DoxyCodeLine{28   \{}
\DoxyCodeLine{29     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}} != 1)}
\DoxyCodeLine{30     \{}
\DoxyCodeLine{31       \mbox{\hyperlink{structsys_1_1_file_a85c6436e8b4af7e755e4dc70587c8dea}{openRead}}();}
\DoxyCodeLine{32     \}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34     \textcolor{keywordflow}{return} fread(\_output.\mbox{\hyperlink{structsys_1_1_vector_ab4707962e08c79e9b149be771a5ed827}{unsafe\_raw}}(), \textcolor{keyword}{sizeof}(\_output[0]), \_output.\mbox{\hyperlink{structsys_1_1_vector_ad9f3c43afb027cd9818fa3d3a9257fdf}{size}}(), \mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}});}
\DoxyCodeLine{35   \}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37   \textcolor{keywordtype}{void} \mbox{\hyperlink{structsys_1_1_file_ac5346b454d8e14c786bee3c223dd6a53}{write\_line}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_string}{String}}\& \_line)}
\DoxyCodeLine{38   \{}
\DoxyCodeLine{39     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}} != 2)}
\DoxyCodeLine{40     \{}
\DoxyCodeLine{41       \mbox{\hyperlink{structsys_1_1_file_ab069971fe988a2dbe9f2bb106acbf7ac}{openWrite}}();}
\DoxyCodeLine{42     \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44     \textcolor{keywordflow}{if}(fputs(\_line.\mbox{\hyperlink{structsys_1_1_string_ac8f19f6869d650281b91279fd0ac6a52}{unsafe\_raw}}(), \mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}}) < 0)}
\DoxyCodeLine{45     \{}
\DoxyCodeLine{46       \textcolor{keywordflow}{throw} \mbox{\hyperlink{structsys_1_1_exception}{Exception}}(\textcolor{stringliteral}{"{}Failed to write"{}});}
\DoxyCodeLine{47     \}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{keywordflow}{if}(fputs(\textcolor{stringliteral}{"{}\(\backslash\)n"{}}, \mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}}) < 0)}
\DoxyCodeLine{50     \{}
\DoxyCodeLine{51       \textcolor{keywordflow}{throw} \mbox{\hyperlink{structsys_1_1_exception}{Exception}}(\textcolor{stringliteral}{"{}Failed to write EOL"{}});}
\DoxyCodeLine{52     \}}
\DoxyCodeLine{53   \}}
\DoxyCodeLine{54 }
\DoxyCodeLine{55   \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_file_a69f67606b851548706a54e6755cbeffb}{read\_line}}(\mbox{\hyperlink{structsys_1_1_string}{String}}\& \_line)}
\DoxyCodeLine{56   \{}
\DoxyCodeLine{57     \textcolor{keyword}{static} \textcolor{keywordtype}{char} buffer[2048] = \{ 0 \};}
\DoxyCodeLine{58 }
\DoxyCodeLine{59     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}} != 1)}
\DoxyCodeLine{60     \{}
\DoxyCodeLine{61       \mbox{\hyperlink{structsys_1_1_file_a85c6436e8b4af7e755e4dc70587c8dea}{openRead}}();}
\DoxyCodeLine{62     \}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64     \_line.\mbox{\hyperlink{structsys_1_1_string_aa8a83da0fad476b938a00cd18b9cf3b4}{clear}}();}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     \textcolor{keywordflow}{while}(\textcolor{keyword}{true})}
\DoxyCodeLine{67     \{}
\DoxyCodeLine{68       \textcolor{keywordtype}{char} *res = fgets(buffer, \textcolor{keyword}{sizeof}(buffer), \mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}});}
\DoxyCodeLine{69       \textcolor{keywordflow}{if}(!res) \textcolor{keywordflow}{break};}
\DoxyCodeLine{70       \_line += res;}
\DoxyCodeLine{71       \textcolor{keywordflow}{if}(\_line.\mbox{\hyperlink{structsys_1_1_string_a0345dc0d93558747627338c230e69f69}{length}}() < 1) \mbox{\hyperlink{namespacesys_ab1ae7414319c425b1a5274f145874149}{sys::panic}}(\textcolor{stringliteral}{"{}Invalid read"{}});}
\DoxyCodeLine{72 }
\DoxyCodeLine{73       \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsys_1_1_file_aa94f4c528f1f023c43a063906d376390}{strip\_endl}}(\_line))}
\DoxyCodeLine{74       \{}
\DoxyCodeLine{75         \textcolor{comment}{// New line char was encountered, end of line reached}}
\DoxyCodeLine{76         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{77       \}}
\DoxyCodeLine{78     \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{keywordflow}{if}(\_line.\mbox{\hyperlink{structsys_1_1_string_a0345dc0d93558747627338c230e69f69}{length}}() > 0)}
\DoxyCodeLine{81     \{}
\DoxyCodeLine{82       \textcolor{comment}{// End of file reached, data remained}}
\DoxyCodeLine{83       \mbox{\hyperlink{structsys_1_1_file_aa94f4c528f1f023c43a063906d376390}{strip\_endl}}(\_line);}
\DoxyCodeLine{84       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{85     \}}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \textcolor{comment}{// End of file reached, no data}}
\DoxyCodeLine{88     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{89   \}}
\DoxyCodeLine{90 }
\DoxyCodeLine{91 \textcolor{keyword}{private}:}
\DoxyCodeLine{92   \mbox{\hyperlink{structsys_1_1_string}{String}} \mbox{\hyperlink{structsys_1_1_file_abc162e8cf65527d4cc1f606c5560ee35}{m\_path}};}
\DoxyCodeLine{93   \mbox{\hyperlink{structsys_1_1_zero}{Zero<int>}} \mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}};}
\DoxyCodeLine{94   \mbox{\hyperlink{structsys_1_1_zero}{Zero<FILE *>}} \mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}};}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   \mbox{\hyperlink{structsys_1_1_file_ad474c0619d221764f33dec594b5886ee}{File}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_file}{File}}\& \_copy);}
\DoxyCodeLine{97   \mbox{\hyperlink{structsys_1_1_file}{File}}\& \mbox{\hyperlink{structsys_1_1_file_a35f283c3043ac3b249bc3f2d51ef059d}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_file}{File}}\& \_other);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99   \textcolor{keywordtype}{void} \mbox{\hyperlink{structsys_1_1_file_a85c6436e8b4af7e755e4dc70587c8dea}{openRead}}()}
\DoxyCodeLine{100   \{}
\DoxyCodeLine{101     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}})}
\DoxyCodeLine{102     \{}
\DoxyCodeLine{103       fclose(\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}});}
\DoxyCodeLine{104     \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}} = 0;}
\DoxyCodeLine{107 \textcolor{preprocessor}{\#ifdef \_MSC\_VER}}
\DoxyCodeLine{108     \textcolor{keywordflow}{if}(fopen\_s(\&\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}}, \mbox{\hyperlink{structsys_1_1_file_abc162e8cf65527d4cc1f606c5560ee35}{m\_path}}.\mbox{\hyperlink{structsys_1_1_string_ac8f19f6869d650281b91279fd0ac6a52}{unsafe\_raw}}(), \textcolor{stringliteral}{"{}rb"{}}))}
\DoxyCodeLine{109     \{}
\DoxyCodeLine{110       \textcolor{keywordflow}{throw} \mbox{\hyperlink{structsys_1_1_exception}{Exception}}(\textcolor{stringliteral}{"{}Failed to open file for reading"{}});}
\DoxyCodeLine{111     \}}
\DoxyCodeLine{112 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{113     \mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}} = fopen(\mbox{\hyperlink{structsys_1_1_file_abc162e8cf65527d4cc1f606c5560ee35}{m\_path}}.\mbox{\hyperlink{structsys_1_1_string_ac8f19f6869d650281b91279fd0ac6a52}{unsafe\_raw}}(), \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{114     \textcolor{keywordflow}{if}(!\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}}) \textcolor{keywordflow}{throw} \mbox{\hyperlink{structsys_1_1_exception}{Exception}}(\textcolor{stringliteral}{"{}Failed to open file for reading"{}});}
\DoxyCodeLine{115 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117     \mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}} = 1;}
\DoxyCodeLine{118   \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{120   \textcolor{keywordtype}{void} \mbox{\hyperlink{structsys_1_1_file_ab069971fe988a2dbe9f2bb106acbf7ac}{openWrite}}()}
\DoxyCodeLine{121   \{}
\DoxyCodeLine{122     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}})}
\DoxyCodeLine{123     \{}
\DoxyCodeLine{124       fclose(\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}});}
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     \mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}} = 0;}
\DoxyCodeLine{128 \textcolor{preprocessor}{\#ifdef \_MSC\_VER}}
\DoxyCodeLine{129     \textcolor{keywordflow}{if}(fopen\_s(\&\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}}, \mbox{\hyperlink{structsys_1_1_file_abc162e8cf65527d4cc1f606c5560ee35}{m\_path}}.\mbox{\hyperlink{structsys_1_1_string_ac8f19f6869d650281b91279fd0ac6a52}{unsafe\_raw}}(), \textcolor{stringliteral}{"{}wb"{}}))}
\DoxyCodeLine{130     \{}
\DoxyCodeLine{131       \textcolor{keywordflow}{throw} \mbox{\hyperlink{structsys_1_1_exception}{Exception}}(\textcolor{stringliteral}{"{}Failed to open file for writing"{}});}
\DoxyCodeLine{132     \}}
\DoxyCodeLine{133 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{134     \mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}} = fopen(\mbox{\hyperlink{structsys_1_1_file_abc162e8cf65527d4cc1f606c5560ee35}{m\_path}}.\mbox{\hyperlink{structsys_1_1_string_ac8f19f6869d650281b91279fd0ac6a52}{unsafe\_raw}}(), \textcolor{stringliteral}{"{}wb"{}});}
\DoxyCodeLine{135     \textcolor{keywordflow}{if}(!\mbox{\hyperlink{structsys_1_1_file_aca6b67dd0b8a25cf6edb1f9e1e0cc950}{m\_raw}}) \textcolor{keywordflow}{throw} \mbox{\hyperlink{structsys_1_1_exception}{Exception}}(\textcolor{stringliteral}{"{}Failed to open file for writing"{}});}
\DoxyCodeLine{136 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{137     \mbox{\hyperlink{structsys_1_1_file_a6696df129ebc91924ee10587e30f6992}{m\_mode}} = 2;}
\DoxyCodeLine{138   \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{140   \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_file_aa94f4c528f1f023c43a063906d376390}{strip\_endl}}(\mbox{\hyperlink{structsys_1_1_string}{String}}\& \_str)}
\DoxyCodeLine{141   \{}
\DoxyCodeLine{142     ssize\_t cleanLen = -\/1;}
\DoxyCodeLine{143     \textcolor{keywordtype}{bool} found = \textcolor{keyword}{false};}
\DoxyCodeLine{144 }
\DoxyCodeLine{145     \textcolor{keywordflow}{for}(ssize\_t ci = \_str.\mbox{\hyperlink{structsys_1_1_string_a0345dc0d93558747627338c230e69f69}{length}}() -\/ 1; ci >= 0; -\/-\/ci)}
\DoxyCodeLine{146     \{}
\DoxyCodeLine{147       \textcolor{keywordtype}{char} c = \_str[ci];}
\DoxyCodeLine{148 }
\DoxyCodeLine{149       \textcolor{keywordflow}{if}(c != \textcolor{charliteral}{'\(\backslash\)n'} \&\& c != \textcolor{charliteral}{'\(\backslash\)r'})}
\DoxyCodeLine{150       \{}
\DoxyCodeLine{151         \textcolor{keywordflow}{break};}
\DoxyCodeLine{152       \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154       \textcolor{keywordflow}{if}(c == \textcolor{charliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{155       \{}
\DoxyCodeLine{156         found = \textcolor{keyword}{true};}
\DoxyCodeLine{157       \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{159       cleanLen = ci;}
\DoxyCodeLine{160     \}}
\DoxyCodeLine{161 }
\DoxyCodeLine{162     \textcolor{keywordflow}{if}(cleanLen != -\/1)}
\DoxyCodeLine{163     \{}
\DoxyCodeLine{164       \_str.\mbox{\hyperlink{structsys_1_1_string_abd94d9f294462ef6b87acbcd0f7e36a7}{resize}}(cleanLen);}
\DoxyCodeLine{165     \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167     \textcolor{keywordflow}{return} found;}
\DoxyCodeLine{168   \}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \};}
\DoxyCodeLine{171 }
\DoxyCodeLine{172 \}}
\DoxyCodeLine{173 }
\DoxyCodeLine{174 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{175 }

\end{DoxyCode}
