\hypertarget{_ptr_8h_source}{}\doxysection{Ptr.\+h}
\label{_ptr_8h_source}\index{src/rend/sys/Ptr.h@{src/rend/sys/Ptr.h}}
\mbox{\hyperlink{_ptr_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef SYS\_PTR\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define SYS\_PTR\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_zero_8h}{Zero.h}}"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_lock_8h}{Lock.h}}"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{config_8h}{config.h}}"{}}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacesys}{sys}}}
\DoxyCodeLine{9 \{}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{12 \textcolor{keyword}{struct }Ptr;}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{15 \textcolor{keyword}{struct }Unique;}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{18 \textcolor{keyword}{struct }List;}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{21 \textcolor{keyword}{struct }Vector;}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{24 \textcolor{keyword}{struct }Weak;}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_enable_ptr}{EnablePtr}}}
\DoxyCodeLine{27 \{}
\DoxyCodeLine{28   \mbox{\hyperlink{structsys_1_1_enable_ptr_acbc853cffc4885960c3d64a974c39d1e}{EnablePtr}}()}
\DoxyCodeLine{29   \{ \}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31   \mbox{\hyperlink{structsys_1_1_enable_ptr_a483f091e45484ce2969469e6a21e402c}{EnablePtr}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_enable_ptr}{EnablePtr}}\& \_copy)}
\DoxyCodeLine{32   \{ \}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34   \mbox{\hyperlink{structsys_1_1_enable_ptr}{EnablePtr}}\& \mbox{\hyperlink{structsys_1_1_enable_ptr_a694fbc3bd33631b59a9e0bac16fea429}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_enable_ptr}{EnablePtr}}\& \_other)}
\DoxyCodeLine{35   \{}
\DoxyCodeLine{36     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{37   \}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{comment}{/*}}
\DoxyCodeLine{40 \textcolor{comment}{  \string~EnablePtr()}}
\DoxyCodeLine{41 \textcolor{comment}{  \{}}
\DoxyCodeLine{42 \textcolor{comment}{    if(m\_lock.count())}}
\DoxyCodeLine{43 \textcolor{comment}{    \{}}
\DoxyCodeLine{44 \textcolor{comment}{      panic("{}Invalid lock [TODO: Remove me]"{});}}
\DoxyCodeLine{45 \textcolor{comment}{    \}}}
\DoxyCodeLine{46 \textcolor{comment}{  \}}}
\DoxyCodeLine{47 \textcolor{comment}{*/}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49 \textcolor{keyword}{private}:}
\DoxyCodeLine{50   \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{51   \textcolor{keyword}{friend} \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_ptr}{Ptr}};}
\DoxyCodeLine{52 }
\DoxyCodeLine{53   \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{54   \textcolor{keyword}{friend} \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_list}{List}};}
\DoxyCodeLine{55 }
\DoxyCodeLine{56   \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{57   \textcolor{keyword}{friend} \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_vector}{Vector}};}
\DoxyCodeLine{58 }
\DoxyCodeLine{59   \mbox{\hyperlink{structsys_1_1_lock_block}{LockBlock}} \mbox{\hyperlink{structsys_1_1_enable_ptr_a6653062a974fc6ea39d2a4d14dae07b1}{m\_lock}};}
\DoxyCodeLine{60 \};}
\DoxyCodeLine{61 }
\DoxyCodeLine{62 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{63 \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_ptr}{Ptr}}}
\DoxyCodeLine{64 \{}
\DoxyCodeLine{65   \mbox{\hyperlink{structsys_1_1_ptr_a6888656c8a6323f7b2ca1863dffcbc32}{Ptr}}();}
\DoxyCodeLine{66 }
\DoxyCodeLine{67   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \mbox{\hyperlink{structsys_1_1_ptr_acaf2d4c44b4cd385777bea101b323f2b}{Ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other);}
\DoxyCodeLine{68   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \mbox{\hyperlink{structsys_1_1_ptr}{Ptr}}\& \mbox{\hyperlink{structsys_1_1_ptr_a1c05ce565416aed92db3e4ee01da7f89}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other);}
\DoxyCodeLine{69 }
\DoxyCodeLine{70   \mbox{\hyperlink{structsys_1_1_ptr_a357eac6579e6cc050a89faed27741259}{Ptr}}(T* \_t);}
\DoxyCodeLine{71   \mbox{\hyperlink{structsys_1_1_ptr}{Ptr}}\& \mbox{\hyperlink{structsys_1_1_ptr_a8a96ffb0a78f8c4512487215993b8b73}{operator=}}(T* \_other);}
\DoxyCodeLine{72 }
\DoxyCodeLine{73   \textcolor{comment}{//Ptr(const PtrLock<T>\& \_lock);}}
\DoxyCodeLine{74   \textcolor{comment}{//Ptr\& operator=(const PtrLock<T>\& \_lock);}}
\DoxyCodeLine{75   \textcolor{comment}{//template <typename U> Ptr(const PtrLock<U>\& \_other);}}
\DoxyCodeLine{76   \textcolor{comment}{//template <typename U> Ptr\& operator=(const PtrLock<U>\& \_other);}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   \textcolor{comment}{//Ptr(const Unique<T>\& \_unique);}}
\DoxyCodeLine{79   \textcolor{comment}{//Ptr\& operator=(const Unique<T>\& \_unique);}}
\DoxyCodeLine{80   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \mbox{\hyperlink{structsys_1_1_ptr_aca0243be86ec0f465dfe92a506a3d427}{Ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_unique}{Unique<U>}}\& \_unique);}
\DoxyCodeLine{81   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \mbox{\hyperlink{structsys_1_1_ptr}{Ptr}}\& \mbox{\hyperlink{structsys_1_1_ptr_aca49c872b697ecb7a66ac385326d356f}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_unique}{Unique<U>}}\& \_unique);}
\DoxyCodeLine{82 }
\DoxyCodeLine{83   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \mbox{\hyperlink{structsys_1_1_ptr_ab97bf8bdc8de2eca0c6f6ed13d5bbc0a}{Ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_weak}{Weak<U>}}\& \_other);}
\DoxyCodeLine{84   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \mbox{\hyperlink{structsys_1_1_ptr}{Ptr}}\& \mbox{\hyperlink{structsys_1_1_ptr_a382199d17e3f05cb156deff596d9b877}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_weak}{Weak<U>}}\& \_other);}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{preprocessor}{\#ifdef SYS\_DEBUG}}
\DoxyCodeLine{87   \mbox{\hyperlink{structsys_1_1_ref_lock}{RefLock<T>}} \mbox{\hyperlink{structsys_1_1_ptr_a8bea6cc3bd36fb9af933b3185630c28a}{operator*}}() \textcolor{keyword}{const};}
\DoxyCodeLine{88   \mbox{\hyperlink{structsys_1_1_ptr_lock}{PtrLock<T>}} \mbox{\hyperlink{structsys_1_1_ptr_a2fff3e815c7adb024d6e269df2ae9483}{operator-\/>}}() \textcolor{keyword}{const};}
\DoxyCodeLine{89 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{90   T\& \mbox{\hyperlink{structsys_1_1_ptr_a8bea6cc3bd36fb9af933b3185630c28a}{operator*}}() \textcolor{keyword}{const};}
\DoxyCodeLine{91   T* \mbox{\hyperlink{structsys_1_1_ptr_a2fff3e815c7adb024d6e269df2ae9483}{operator-\/>}}() \textcolor{keyword}{const};}
\DoxyCodeLine{92 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   \textcolor{comment}{//bool operator==(const Ptr\& \_other) const;}}
\DoxyCodeLine{95   \textcolor{comment}{//bool operator!=(const Ptr\& \_other) const;}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97   \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_af1d1688937984923ff9160c6824a5927}{operator==}}(T* \_other) \textcolor{keyword}{const};}
\DoxyCodeLine{98   \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_a1c9503cc5fa667a4dc3575ce9f030a4a}{operator!=}}(T* \_other) \textcolor{keyword}{const};}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_a02d290564ff77e7f1e133ccf80065557}{operator==}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other) \textcolor{keyword}{const};}
\DoxyCodeLine{101   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_a8256d0bb47c1bedcceecbf9b3af83fcf}{operator!=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other) \textcolor{keyword}{const};}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   T* \mbox{\hyperlink{structsys_1_1_ptr_aa52ab4b7946320c99435930c0d5307de}{unsafe\_raw}}() \textcolor{keyword}{const};}
\DoxyCodeLine{104   \textcolor{keywordtype}{void} \mbox{\hyperlink{structsys_1_1_ptr_a6d3bb8d15c499c866447ef62175e797e}{reset}}();}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U> \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}} \mbox{\hyperlink{structsys_1_1_ptr_a6818d4625e6c9ad30c77ed93287e1902}{cast}}() \textcolor{keyword}{const};}
\DoxyCodeLine{107 }
\DoxyCodeLine{108 \textcolor{keyword}{private}:}
\DoxyCodeLine{109   \textcolor{comment}{// TODO: Rename this}}
\DoxyCodeLine{110   \textcolor{keyword}{typedef} void (\mbox{\hyperlink{structsys_1_1_ptr}{Ptr}}::*\mbox{\hyperlink{structsys_1_1_ptr_a8cec3f7b36dda2bad96585370d50db65}{BoolType}})() \textcolor{keyword}{const};}
\DoxyCodeLine{111   \textcolor{keywordtype}{void} \mbox{\hyperlink{structsys_1_1_ptr_ac181e503774dbd1f23b8b6167e389bb1}{this\_type\_does\_not\_support\_comparisons}}()\textcolor{keyword}{ const }\{\}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 \textcolor{keyword}{public}:}
\DoxyCodeLine{114   \textcolor{keyword}{operator} \mbox{\hyperlink{structsys_1_1_ptr_a8cec3f7b36dda2bad96585370d50db65}{BoolType}}() \textcolor{keyword}{const};}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 \textcolor{keyword}{private}:}
\DoxyCodeLine{117   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{118   \textcolor{keyword}{friend} \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_list}{List}};}
\DoxyCodeLine{119 }
\DoxyCodeLine{120   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{121   \textcolor{keyword}{friend} \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_vector}{Vector}};}
\DoxyCodeLine{122 }
\DoxyCodeLine{123   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{124   \textcolor{keyword}{friend} \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_ptr}{Ptr}};}
\DoxyCodeLine{125 }
\DoxyCodeLine{126   \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{127   \textcolor{keyword}{friend} \textcolor{keyword}{struct }\mbox{\hyperlink{structsys_1_1_ref_lock}{RefLock}};}
\DoxyCodeLine{128 }
\DoxyCodeLine{129   \mbox{\hyperlink{structsys_1_1_zero}{Zero<T*>}} \mbox{\hyperlink{structsys_1_1_ptr_a44d21e9ed464a28e114933ea7c445df6}{m\_ptr}};}
\DoxyCodeLine{130   \mbox{\hyperlink{structsys_1_1_lock}{Lock}} \mbox{\hyperlink{structsys_1_1_ptr_a98a9e0d72aa47ac048fd3d790a0c9ea5}{m\_lock}};}
\DoxyCodeLine{131 }
\DoxyCodeLine{132 \};}
\DoxyCodeLine{133 }
\DoxyCodeLine{134 \}}
\DoxyCodeLine{135 }
\DoxyCodeLine{136 \textcolor{comment}{/* Implementation */}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_unique_8h}{Unique.h}}"{}}}
\DoxyCodeLine{139 }
\DoxyCodeLine{140 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacesys}{sys}}}
\DoxyCodeLine{141 \{}
\DoxyCodeLine{142 }
\DoxyCodeLine{143 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{144 \mbox{\hyperlink{structsys_1_1_ptr_a88451fd4df98e8d9f813a7938e12194c}{Ptr<T>::Ptr}}()}
\DoxyCodeLine{145 \{ \}}
\DoxyCodeLine{146 }
\DoxyCodeLine{147 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{148 \mbox{\hyperlink{structsys_1_1_ptr_a88451fd4df98e8d9f813a7938e12194c}{Ptr<T>::Ptr}}(T* \_t) :}
\DoxyCodeLine{149   m\_ptr(\_t),}
\DoxyCodeLine{150   m\_lock(\_t ? \&\_t-\/>m\_lock : NULL)}
\DoxyCodeLine{151 \{ \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{154 \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<T>}}\& \mbox{\hyperlink{structsys_1_1_ptr_a1c05ce565416aed92db3e4ee01da7f89}{Ptr<T>::operator=}}(T* \_other)}
\DoxyCodeLine{155 \{}
\DoxyCodeLine{156   \textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_lock_block}{LockBlock}}* olb = \_other ? \&\_other-\/>m\_lock : NULL;}
\DoxyCodeLine{157 }
\DoxyCodeLine{158   \textcolor{keywordflow}{if}(m\_ptr != \_other ||}
\DoxyCodeLine{159     m\_lock.block() != olb)}
\DoxyCodeLine{160   \{}
\DoxyCodeLine{161     m\_ptr = \_other;}
\DoxyCodeLine{162     m\_lock.lock(olb);}
\DoxyCodeLine{163   \}}
\DoxyCodeLine{164 }
\DoxyCodeLine{165   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{166 \}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 \textcolor{comment}{/*}}
\DoxyCodeLine{169 \textcolor{comment}{template <typename T>}}
\DoxyCodeLine{170 \textcolor{comment}{Ptr<T>::Ptr(const Unique<T>\& \_unique) :}}
\DoxyCodeLine{171 \textcolor{comment}{  m\_ptr(\_unique.m\_ptr),}}
\DoxyCodeLine{172 \textcolor{comment}{  m\_lock(\_unique.m\_lock)}}
\DoxyCodeLine{173 \textcolor{comment}{\{ \}}}
\DoxyCodeLine{174 \textcolor{comment}{*/}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176 \textcolor{comment}{/*}}
\DoxyCodeLine{177 \textcolor{comment}{template <typename T>}}
\DoxyCodeLine{178 \textcolor{comment}{Ptr<T>\& Ptr<T>::operator=(const Unique<T>\& \_unique)}}
\DoxyCodeLine{179 \textcolor{comment}{\{}}
\DoxyCodeLine{180 \textcolor{comment}{  m\_ptr = \_unique.m\_ptr;}}
\DoxyCodeLine{181 \textcolor{comment}{  m\_lock.lock(\_unique.m\_lock);}}
\DoxyCodeLine{182 \textcolor{comment}{}}
\DoxyCodeLine{183 \textcolor{comment}{  return *this;}}
\DoxyCodeLine{184 \textcolor{comment}{\}}}
\DoxyCodeLine{185 \textcolor{comment}{*/}}
\DoxyCodeLine{186 }
\DoxyCodeLine{187 \textcolor{comment}{/*}}
\DoxyCodeLine{188 \textcolor{comment}{template <typename T>}}
\DoxyCodeLine{189 \textcolor{comment}{Ptr<T>::Ptr(const PtrLock<T>\& \_lock) :}}
\DoxyCodeLine{190 \textcolor{comment}{  m\_ptr(\_lock.m\_ptr),}}
\DoxyCodeLine{191 \textcolor{comment}{  m\_lock(\_lock.m\_lock)}}
\DoxyCodeLine{192 \textcolor{comment}{\{ \}}}
\DoxyCodeLine{193 \textcolor{comment}{*/}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195 \textcolor{comment}{// TODO: Shall we make non-\/template version? Is synthesised version safe?}}
\DoxyCodeLine{196 }
\DoxyCodeLine{197 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{198 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{199 \mbox{\hyperlink{structsys_1_1_ptr_a88451fd4df98e8d9f813a7938e12194c}{Ptr<T>::Ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other) :}
\DoxyCodeLine{200   m\_ptr(\_other.m\_ptr),}
\DoxyCodeLine{201   m\_lock(\_other.m\_lock)}
\DoxyCodeLine{202 \{ \}}
\DoxyCodeLine{203 }
\DoxyCodeLine{204 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{205 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{206 \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<T>}}\& \mbox{\hyperlink{structsys_1_1_ptr_a1c05ce565416aed92db3e4ee01da7f89}{Ptr<T>::operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other)}
\DoxyCodeLine{207 \{}
\DoxyCodeLine{208   \textcolor{keywordflow}{if}(m\_ptr != \_other.\mbox{\hyperlink{structsys_1_1_ptr_a44d21e9ed464a28e114933ea7c445df6}{m\_ptr}} ||}
\DoxyCodeLine{209     m\_lock.block() != \_other.\mbox{\hyperlink{structsys_1_1_ptr_a98a9e0d72aa47ac048fd3d790a0c9ea5}{m\_lock}}.\mbox{\hyperlink{structsys_1_1_lock_ad948184426f1f9a8c336483ec5fd03c0}{block}}())}
\DoxyCodeLine{210   \{}
\DoxyCodeLine{211     m\_ptr = \_other.\mbox{\hyperlink{structsys_1_1_ptr_a44d21e9ed464a28e114933ea7c445df6}{m\_ptr}};}
\DoxyCodeLine{212     m\_lock = \_other.\mbox{\hyperlink{structsys_1_1_ptr_a98a9e0d72aa47ac048fd3d790a0c9ea5}{m\_lock}};}
\DoxyCodeLine{213   \}}
\DoxyCodeLine{214 }
\DoxyCodeLine{215   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{216 \}}
\DoxyCodeLine{217 }
\DoxyCodeLine{218 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{219 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{220 \mbox{\hyperlink{structsys_1_1_ptr_a88451fd4df98e8d9f813a7938e12194c}{Ptr<T>::Ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_unique}{Unique<U>}}\& \_unique) :}
\DoxyCodeLine{221   m\_ptr(\_unique.m\_ptr),}
\DoxyCodeLine{222   m\_lock(\_unique.m\_lock)}
\DoxyCodeLine{223 \{ \}}
\DoxyCodeLine{224  }
\DoxyCodeLine{225 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{226 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{227 \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<T>}}\& \mbox{\hyperlink{structsys_1_1_ptr_a1c05ce565416aed92db3e4ee01da7f89}{Ptr<T>::operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_unique}{Unique<U>}}\& \_unique)}
\DoxyCodeLine{228 \{}
\DoxyCodeLine{229   m\_ptr = \_unique.\mbox{\hyperlink{structsys_1_1_unique_a05f6265b182749141cc6950934eb18b4}{m\_ptr}};}
\DoxyCodeLine{230   m\_lock.lock(\_unique.\mbox{\hyperlink{structsys_1_1_unique_af2968dcc0603024c29f5eaa2d749cf1d}{m\_lock}});}
\DoxyCodeLine{231 }
\DoxyCodeLine{232   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{233 \}}
\DoxyCodeLine{234 }
\DoxyCodeLine{235 \textcolor{comment}{// TODO: Do we need to check m\_rc if m\_ptr is valid?}}
\DoxyCodeLine{236 }
\DoxyCodeLine{237 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{238 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{239 \mbox{\hyperlink{structsys_1_1_ptr_a88451fd4df98e8d9f813a7938e12194c}{Ptr<T>::Ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_weak}{Weak<U>}}\& \_other) :}
\DoxyCodeLine{240   m\_ptr((\_other.m\_rc \&\& \_other.m\_rc-\/>strong) ? \_other.m\_ptr : NULL),}
\DoxyCodeLine{241   m\_lock(\_other.m\_rc ? \&\_other.m\_rc-\/>lock : NULL)}
\DoxyCodeLine{242 \{ \}}
\DoxyCodeLine{243 }
\DoxyCodeLine{244 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{245 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{246 \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<T>}}\& \mbox{\hyperlink{structsys_1_1_ptr_a1c05ce565416aed92db3e4ee01da7f89}{Ptr<T>::operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_weak}{Weak<U>}}\& \_weak)}
\DoxyCodeLine{247 \{}
\DoxyCodeLine{248   m\_ptr = (\_weak.\mbox{\hyperlink{structsys_1_1_weak_afe35d172768f38a1b8a479e75941f366}{m\_rc}} \&\& \_weak.\mbox{\hyperlink{structsys_1_1_weak_afe35d172768f38a1b8a479e75941f366}{m\_rc}}-\/>strong) ? \_weak.\mbox{\hyperlink{structsys_1_1_weak_a3b702c4fd1d9ddf447395fa88a0b91f9}{m\_ptr}} : NULL;}
\DoxyCodeLine{249   m\_lock.lock(\_weak.\mbox{\hyperlink{structsys_1_1_weak_afe35d172768f38a1b8a479e75941f366}{m\_rc}} ? \_weak.\mbox{\hyperlink{structsys_1_1_weak_afe35d172768f38a1b8a479e75941f366}{m\_rc}}-\/>lock : NULL);}
\DoxyCodeLine{250 }
\DoxyCodeLine{251   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{252 \}}
\DoxyCodeLine{253 }
\DoxyCodeLine{254 \textcolor{comment}{/*}}
\DoxyCodeLine{255 \textcolor{comment}{template <typename T>}}
\DoxyCodeLine{256 \textcolor{comment}{Ptr<T>\& Ptr<T>::operator=(const PtrLock<T>\& \_lock)}}
\DoxyCodeLine{257 \textcolor{comment}{\{}}
\DoxyCodeLine{258 \textcolor{comment}{  m\_ptr = \_lock.m\_ptr;}}
\DoxyCodeLine{259 \textcolor{comment}{  m\_lock = \_lock.m\_lock;}}
\DoxyCodeLine{260 \textcolor{comment}{}}
\DoxyCodeLine{261 \textcolor{comment}{  return *this;}}
\DoxyCodeLine{262 \textcolor{comment}{\}}}
\DoxyCodeLine{263 \textcolor{comment}{*/}}
\DoxyCodeLine{264 }
\DoxyCodeLine{265 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{266 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{267 \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_af1d1688937984923ff9160c6824a5927}{Ptr<T>::operator==}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other)\textcolor{keyword}{ const}}
\DoxyCodeLine{268 \textcolor{keyword}{}\{}
\DoxyCodeLine{269   \textcolor{keywordflow}{return} m\_ptr == \_other.\mbox{\hyperlink{structsys_1_1_ptr_a44d21e9ed464a28e114933ea7c445df6}{m\_ptr}};}
\DoxyCodeLine{270 \}}
\DoxyCodeLine{271 }
\DoxyCodeLine{272 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{273 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{274 \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_a1c9503cc5fa667a4dc3575ce9f030a4a}{Ptr<T>::operator!=}}(\textcolor{keyword}{const} \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}}\& \_other)\textcolor{keyword}{ const}}
\DoxyCodeLine{275 \textcolor{keyword}{}\{}
\DoxyCodeLine{276   \textcolor{keywordflow}{return} m\_ptr != \_other.\mbox{\hyperlink{structsys_1_1_ptr_a44d21e9ed464a28e114933ea7c445df6}{m\_ptr}};}
\DoxyCodeLine{277 \}}
\DoxyCodeLine{278 }
\DoxyCodeLine{279 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{280 \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_af1d1688937984923ff9160c6824a5927}{Ptr<T>::operator==}}(T* \_other)\textcolor{keyword}{ const}}
\DoxyCodeLine{281 \textcolor{keyword}{}\{}
\DoxyCodeLine{282   \textcolor{keywordflow}{return} m\_ptr == \_other;}
\DoxyCodeLine{283 \}}
\DoxyCodeLine{284 }
\DoxyCodeLine{285 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{286 \textcolor{keywordtype}{bool} \mbox{\hyperlink{structsys_1_1_ptr_a1c9503cc5fa667a4dc3575ce9f030a4a}{Ptr<T>::operator!=}}(T* \_other)\textcolor{keyword}{ const}}
\DoxyCodeLine{287 \textcolor{keyword}{}\{}
\DoxyCodeLine{288   \textcolor{keywordflow}{return} m\_ptr != \_other;}
\DoxyCodeLine{289 \}}
\DoxyCodeLine{290 }
\DoxyCodeLine{291 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{292 \textcolor{keyword}{template} <\textcolor{keyword}{typename} U>}
\DoxyCodeLine{293 \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}} \mbox{\hyperlink{structsys_1_1_ptr_a6818d4625e6c9ad30c77ed93287e1902}{Ptr<T>::cast}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{294 \textcolor{keyword}{}\{}
\DoxyCodeLine{295   \textcolor{comment}{// TODO: Clean}}
\DoxyCodeLine{296   \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<U>}} rtn;}
\DoxyCodeLine{297   rtn.\mbox{\hyperlink{structsys_1_1_ptr_a44d21e9ed464a28e114933ea7c445df6}{m\_ptr}} = \textcolor{keyword}{dynamic\_cast<}U*\textcolor{keyword}{>}(\textcolor{keyword}{static\_cast<}T*\textcolor{keyword}{>}(m\_ptr));}
\DoxyCodeLine{298 }
\DoxyCodeLine{299   \textcolor{keywordflow}{if}(rtn.\mbox{\hyperlink{structsys_1_1_ptr_a44d21e9ed464a28e114933ea7c445df6}{m\_ptr}})}
\DoxyCodeLine{300   \{}
\DoxyCodeLine{301     rtn.\mbox{\hyperlink{structsys_1_1_ptr_a98a9e0d72aa47ac048fd3d790a0c9ea5}{m\_lock}} = m\_lock;}
\DoxyCodeLine{302   \}}
\DoxyCodeLine{303 }
\DoxyCodeLine{304   \textcolor{keywordflow}{return} rtn;}
\DoxyCodeLine{305 \}}
\DoxyCodeLine{306 }
\DoxyCodeLine{307 \textcolor{preprocessor}{\#ifdef SYS\_DEBUG}}
\DoxyCodeLine{308 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{309 \mbox{\hyperlink{structsys_1_1_ref_lock}{RefLock<T>}} \mbox{\hyperlink{structsys_1_1_ptr_a8bea6cc3bd36fb9af933b3185630c28a}{Ptr<T>::operator*}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{310 \textcolor{keyword}{}\{}
\DoxyCodeLine{311   \textcolor{keywordflow}{return} \mbox{\hyperlink{structsys_1_1_ref_lock}{RefLock<T>}}(m\_ptr, m\_lock.block());}
\DoxyCodeLine{312 \}}
\DoxyCodeLine{313 }
\DoxyCodeLine{314 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{315 \mbox{\hyperlink{structsys_1_1_ptr_lock}{PtrLock<T>}} \mbox{\hyperlink{structsys_1_1_ptr_a2fff3e815c7adb024d6e269df2ae9483}{Ptr<T>::operator-\/>}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{316 \textcolor{keyword}{}\{}
\DoxyCodeLine{317   \textcolor{keywordflow}{return} \mbox{\hyperlink{structsys_1_1_ptr_lock}{PtrLock<T>}}(m\_ptr, m\_lock.block());}
\DoxyCodeLine{318 \}}
\DoxyCodeLine{319 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{320 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{321 T\& \mbox{\hyperlink{structsys_1_1_ptr_a8bea6cc3bd36fb9af933b3185630c28a}{Ptr<T>::operator*}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{322 \textcolor{keyword}{}\{}
\DoxyCodeLine{323   \textcolor{keywordflow}{return} *m\_ptr;}
\DoxyCodeLine{324 \}}
\DoxyCodeLine{325 }
\DoxyCodeLine{326 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{327 T* \mbox{\hyperlink{structsys_1_1_ptr_a2fff3e815c7adb024d6e269df2ae9483}{Ptr<T>::operator-\/>}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{328 \textcolor{keyword}{}\{}
\DoxyCodeLine{329   \textcolor{keywordflow}{return} m\_ptr;}
\DoxyCodeLine{330 \}}
\DoxyCodeLine{331 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{332 }
\DoxyCodeLine{333 \textcolor{comment}{/*}}
\DoxyCodeLine{334 \textcolor{comment}{template <typename T>}}
\DoxyCodeLine{335 \textcolor{comment}{bool Ptr<T>::operator==(const Ptr\& \_other) const}}
\DoxyCodeLine{336 \textcolor{comment}{\{}}
\DoxyCodeLine{337 \textcolor{comment}{  return m\_ptr == \_other.m\_ptr;}}
\DoxyCodeLine{338 \textcolor{comment}{\}}}
\DoxyCodeLine{339 \textcolor{comment}{}}
\DoxyCodeLine{340 \textcolor{comment}{template <typename T>}}
\DoxyCodeLine{341 \textcolor{comment}{bool Ptr<T>::operator!=(const Ptr\& \_other) const}}
\DoxyCodeLine{342 \textcolor{comment}{\{}}
\DoxyCodeLine{343 \textcolor{comment}{  return m\_ptr != \_other.m\_ptr;}}
\DoxyCodeLine{344 \textcolor{comment}{\}}}
\DoxyCodeLine{345 \textcolor{comment}{*/}}
\DoxyCodeLine{346 }
\DoxyCodeLine{347 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{348 T* \mbox{\hyperlink{structsys_1_1_ptr_aa52ab4b7946320c99435930c0d5307de}{Ptr<T>::unsafe\_raw}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{349 \textcolor{keyword}{}\{}
\DoxyCodeLine{350   \textcolor{keywordflow}{return} m\_ptr;}
\DoxyCodeLine{351 \}}
\DoxyCodeLine{352 }
\DoxyCodeLine{353 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{354 \textcolor{keywordtype}{void} \mbox{\hyperlink{structsys_1_1_ptr_a6d3bb8d15c499c866447ef62175e797e}{Ptr<T>::reset}}()}
\DoxyCodeLine{355 \{}
\DoxyCodeLine{356   m\_lock.lock(NULL);}
\DoxyCodeLine{357   m\_ptr = NULL;}
\DoxyCodeLine{358 \}}
\DoxyCodeLine{359 }
\DoxyCodeLine{360 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{361 \mbox{\hyperlink{structsys_1_1_ptr}{Ptr<T>::operator}} BoolType()\textcolor{keyword}{ const}}
\DoxyCodeLine{362 \textcolor{keyword}{}\{}
\DoxyCodeLine{363   \textcolor{keywordflow}{if}(m\_ptr)}
\DoxyCodeLine{364   \{}
\DoxyCodeLine{365     \textcolor{keywordflow}{return} \&\mbox{\hyperlink{structsys_1_1_ptr_ac181e503774dbd1f23b8b6167e389bb1}{Ptr::this\_type\_does\_not\_support\_comparisons}};}
\DoxyCodeLine{366   \}}
\DoxyCodeLine{367 }
\DoxyCodeLine{368   \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{369 \}}
\DoxyCodeLine{370 }
\DoxyCodeLine{371 \}}
\DoxyCodeLine{372 }
\DoxyCodeLine{373 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{374 }

\end{DoxyCode}
